<div id="camp_enrollment_<%= camp_enrollment.id %>">
  <% name_style = !camp_enrollment.paid ? 'color: red;font-weight:bold' : '' %>
  <div id="target-<%=camp_enrollment.id%>" class="row card-row card-row-higher clickable-tr <%= 'bg-white' if index.odd? %>" data-clickable-table-target="clickable" data-url="<%= managers_student_path(camp_enrollment.student) %>">
    <% student = camp_enrollment.student %>
    <div class="col-2 flexy-row">
      <span class="ellipsis" style="<%= name_style %>"><%= student.last_name %></span>
    </div>
    <div class="col-2 flexy-row">
      <span class="ellipsis" style="<%= name_style %>"><%= student.first_name %></span>
    </div>
    <div class="col-2 flexy-row">
      <span class="ellipsis"><%= "#{camp_enrollment.camp.academy.name }-#{camp_enrollment.camp.school_period.name}-#{camp_enrollment.camp.name}" %></span>
    </div>
    <div class="col-1 flexy-row small-col">
      <span class="ellipsis"><%= camp_enrollment.camp.school_period.price %>€</span>
    </div>
    <% if camp_enrollment.paid %>
      <% if camp_enrollment.payment_date %>
        <div class="col-1 flexy-row">
          <span class="ellipsis"><%= l(camp_enrollment.payment_date, formats: :default) %></span>
        </div>
      <% else %>
        <div class="col-1 flexy-row">
          <span class="ellipsis"></span>
        </div>
      <% end %>
      <div class="col-1 flexy-row">
        <span class="ellipsis"><%= camp_enrollment.payment_method %></span>
      </div>
      <div class="col-2 flexy-row">
        <span class="ellipsis"><%= camp_enrollment.receiver&.full_name %></span>
      </div>
      <div class="col-1 flexy-row small-col">
        <i class="fa-solid fa-circle-check text-success fa-small"></i>
      </div>
    <% else %>
      <div class="col-4 flexy-row">
        <span class="ellipsis">
          <button type="button" class="btn-add-student btn-add-pink" data-bs-toggle="modal" data-bs-target="#campEnrollment<%=camp_enrollment.id%>Modal">
            <i class="fa-solid fa-square-plus fa-square-bigger"></i>PAYER<i class="fa-solid fa-square-plus fa-square-bigger"></i>
          </button>
        </span>
      </div>
      <div class="col-1 flexy-row small-col">
        <i class="fa-solid fa-circle-xmark fa-pink fa-big fa-small"></i>
      </div>
    <% end %>
  </div>

</div>
  <!-- Modal -->
  <div class="modal fade" id="campEnrollment<%= camp_enrollment.id %>Modal" tabindex="-1" aria-labelledby="campEnrollment<%= camp_enrollment.id %>ModalLabel" aria-hidden="true" data-controller="close-modal">
    <div class="modal-dialog">
      <div class="modal-content" style="width:80%;padding:0px">
        <div class="modal-header modal-header-deposit">
          <h5 class="modal-title"><%= "Stage #{camp_enrollment.camp.academy.name }-#{camp_enrollment.camp.school_period.name}-#{camp_enrollment.camp.name}" %><br><%= camp_enrollment.student.full_name %></h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <%= simple_form_for camp_enrollment, url: managers_camp_enrollment_path(camp_enrollment), data: { action: "submit->close-modal#closeModal", turbo: local_assigns[:reload] ? false : true }, method: :patch do |f| %>
          <div class="modal-body">
            <%= f.hidden_field :source, value: "list" %>
            <%= f.hidden_field :index, value: index %>
            <%= f.hidden_field :origin, value: show_camp_managers_finance_path(camp_enrollment.camp) %>
            <%= f.input :payment_method,
                        label: "Moyen de paiment",
                        required: true,
                        collection: [['Chèque', 'cheque'], ['Espèces', 'cash'], ['Hello Asso', 'hello_asso'], ['Pass', 'pass'], ['Virement', 'virement'], ['Offert', 'offert']],
                        prompt: "Sélectionner" %>
            <%= f.input :receiver_id,
                        label: "Personne ayant reçu le paiment",
                        collection: User.all.order(:last_name).map { |user| [user.full_name_reverse, user.id] },
                        selected: camp_enrollment.receiver_id.present? ? camp_enrollment.receiver_id : current_user.id,
                        prompt: "Sélectionner",
                        include_blank: true %>
          </div>
          <div class="modal-footer d-flex justify-content-around">
            <%= f.submit "Valider", class: "btn-add-student btn-add-student-small" %>
            <button type="button" class="btn-add-student btn-add-student-small btn-add-student-grey" data-bs-dismiss="modal">Annuler</button>
          </div>
        <% end %>
      </div>
    </div>
  </div>
