<div class="card mb-3">
  <div class="card-body">

    <p class="card-text">Academie : <%= @course.academy.name %></p>
    <p class="card-text">Période : <%= @course.school_period.name.upcase %></p>
    <p class="card-text">Stage : <%= @course.camp.name %></p>
    <p class="card-text">Cours : <%= @course.activity.name %></p>
    <div>
    <p class="card-text">Jour : <%= @course.starts_at.strftime("%A %e %B") %></p>
    <%= form_with(model: @course, url: managers_course_path(@course), method: :patch) do |form| %>
      <%= form.label :starts_at, "De" %>
      <%= form.time_select :starts_at, minute_step: 15, class: "form-control" %>

      <%= form.label :ends_at, "A" %>
      <%= form.time_select :ends_at, minute_step: 15, class: "form-control" %>

    </div>
      <%= form.submit "Mettre à jour les horaires", class: "btn btn-primary mt-3" %>
    <% end %>

  </div>
  <div class="card-footer text-center">
    <%= link_to "Modifier", edit_managers_course_path(@course), class: "btn btn-primary" %>
    <%= link_to 'Supprimer', managers_course_path(@course), data: {turbo_method: :delete, turbo_confirm: 'Are you sure?'}, class: "btn btn-primary"  %>
    <%= link_to "Retour", managers_courses_path, class: "btn btn-primary" %>
  </div>
</div>


<%= form_with(url: update_enrollments_managers_course_path(@course), method: :put) do |form| %>
  <% @enrollments.each do |enrollment| %>
      <div class="form-check form-switch presence-sheet-form">
        <%= form.label "Student #{enrollment.student.id}", nil, class: "form-check-label" %>
        <%= form.check_box "enrollments[#{enrollment.id}][present]", { class: "form-check-input", id: "present-#{enrollment.id}", checked: enrollment.present }, 1, 0 %>
        <span class="absent-text d-none">absent</span>
      </div>
  <% end %>
  <%= form.submit "Valider", class: "btn btn-primary mt-3" %>
<% end %>

<script>
  const checkboxes = document.querySelectorAll(".presence-sheet-form input[type='checkbox']");
  checkboxes.forEach(function(checkbox) {
    const absentText = checkbox.parentElement.querySelector(".absent-text");
    checkbox.addEventListener("change", function() {
      if (this.checked) {
        absentText.classList.add("d-none");
      } else {
        absentText.classList.remove("d-none");
      }
    });
  });
</script>
