<button id="clear-filters">Effacer les filtres</button>
<table>
  <thead>
    <tr>
      <th>Nom</th>
      <th>Jour</th>
      <th>Heure de d√©but</th>
      <th>Heure de fin</th>
    </tr>
    <tr>
      <td>
        <select id="filter-name">
          <option value="">Tous</option>
          <% @courses.map{ |course| course.activity.name }.uniq.each do |name| %>
            <option value="<%= name %>"><%= name %></option>
          <% end %>
        </select>
      </td>
      <td>
        <select id="filter-day">
          <option value="">Tous</option>
          <% @courses.map{ |course| course.starts_at.strftime("%A %e %B") }.uniq.each do |day| %>
            <option value="<%= day %>"><%= day %></option>
          <% end %>
        </select>
      </td>
      <td>
        <select id="filter-start-time">
          <option value="">Tous</option>
          <% @courses.map{ |course| course.starts_at.strftime("%H:%M") }.uniq.each do |start_time| %>
            <option value="<%= start_time %>"><%= start_time %></option>
          <% end %>
        </select>
      </td>
      <td>
        <select id="filter-end-time">
          <option value="">Tous</option>
          <% @courses.map{ |course| course.ends_at.strftime("%H:%M") }.uniq.each do |end_time| %>
            <option value="<%= end_time %>"><%= end_time %></option>
          <% end %>
        </select>
      </td>
    </tr>
  </thead>
  <tbody id="courses">
    <% @courses.each do |course|%>
    <tr>
      <td class="name"><%= course.activity.name %></td>
      <td class="day"><%= course.starts_at.strftime("%A %e %B") %></td>
      <td class="start"><%= course.starts_at.strftime("%H:%M") %></td>
      <td class="end"><%= course.ends_at.strftime("%H:%M") %></td>
    </tr>
    <% end %>
  </tbody>
</table>

<script>
const courses = <%= @courses.to_json.html_safe %>;

document.addEventListener('DOMContentLoaded', () => {
  const selectors = document.querySelectorAll('select');
  const tableRows = document.querySelectorAll('tbody tr');

  document.querySelector('#clear-filters').addEventListener('click', () => {
  selectors.forEach((selector) => {
    selector.value = '';
  });
  tableRows.forEach((row) => {
    row.style.display = 'table-row';
  });
});

  selectors.forEach((selector) => {
    selector.addEventListener('change', () => {
      const nameFilter = document.querySelector('#filter-name').value;
      const dayFilter = document.querySelector('#filter-day').value;
      const startFilter = document.querySelector('#filter-start-time').value;
      const endFilter = document.querySelector('#filter-end-time').value;

      tableRows.forEach((row) => {
        const name = row.querySelector('td:nth-child(1)').innerText;
        const day = row.querySelector('td:nth-child(2)').innerText;
        const start = row.querySelector('td:nth-child(3)').innerText;
        const end = row.querySelector('td:nth-child(4)').innerText;

        if (
          (!nameFilter || name.indexOf(nameFilter) !== -1) &&
          (!dayFilter || day.indexOf(dayFilter) !== -1) &&
          (!startFilter || start.indexOf(startFilter) !== -1) &&
          (!endFilter || end.indexOf(endFilter) !== -1)
        ) {
          row.style.display = 'table-row';
        } else {
          row.style.display = 'none';
        }
      });
    });
  });
});
</script>
