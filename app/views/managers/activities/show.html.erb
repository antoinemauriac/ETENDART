<%= render "shared/academy_header" %>
<div class="header-nav">
  <div class="header-nav-item"><%= link_to @activity.academy.name.upcase, managers_academy_path(@academy) %></div>
  <div class="header-nav-item"><%= link_to "LES STAGES", managers_school_periods_path(academy: @academy) %></div>
  <div class="header-nav-item"><%= link_to "#{@school_period.name.upcase} - #{@school_period.year}", managers_school_period_path(@school_period) %></div>
  <div class="header-nav-item"><%= link_to @camp.name.upcase, managers_camp_path(@camp) %></div>
  <div class="header-nav-item active"><%= @activity.name.upcase %></div>
</div>
<div class="yellow-title"><%= @activity.name.upcase %></div>
<div class="row justify-content-center align-items-stretch">

  <div class="col-8" >
    <div class="header-info">COURS</div>
    <table class="table table-striped table-responsive table-center form-container form-container-activity">
      <thead>
        <tr>
          <th>Date</th>
          <th>Heure de début</th>
          <th>Heure de fin</th>
          <th>Modifier</th>
          <th>Supprimer</th>
        </tr>
      </thead>
      <tbody>
        <% @courses.each do |course| %>
          <tr>
            <td class="align-middle">
              <div class="d-flex">
                <%= link_to l(course.starts_at, format: :abbr), managers_course_path(course), data: { turbo: false }, class: "btn-etendart-yellow mb-2", style: "width: 80%" %>
              </div>
            </td>
            <%= simple_form_for course, url: managers_course_path(course, redirect_to: "camp" ), method: :put, data: { turbo: false } do |f| %>
              <td class="align-middle">
                <%= f.input :starts_at, as: :time, label: false, minute_step: 15 %>
              </td>
              <td class="align-middle">
                <%= f.input :ends_at, as: :time, label: false, minute_step: 15 %>
              </td>
              <td class="align-middle">
                <%= f.submit "Valider", class: 'btn-etendart-yellow mb-2' %>
              </td>
            <% end %>
            <td class="align-middle">
              <% if course.starts_at > Time.current - 1.week  %>
                <%= link_to managers_course_path(course, redirect_to: "camp"), data: {turbo_method: :delete, turbo_confirm: "Êtes-vous sûr de vouloir supprimer ce cours ?"} do %>
                  <i class="fas fa-trash trash"></i>
                <% end %>
              <% end %>
            </td>
          </tr>
        <% end %>
      </tbody>
    </table>
  </div>
  <div class="col-4">
    <div class="header-info">COACH</div>
    <div class="form-container form-container-activity">
      <%= simple_form_for @activity, url: managers_activity_path(@activity, redirect_to: "camp" ), method: :patch do |f| %>

      <%= f.input :coach_id, as: :select, label: "Coach Principal", collection: @coaches, label_method: :full_name, value_method: :id, input_html: { class: "tom-select", data: { controller: "tom-select" } } %>
      <%= f.input :coach_ids, as: :select, label: "Autres coachs", collection: @coaches.reject { |coach| coach == @coach }, label_method: :full_name, input_html: { class: "tom-select", multiple: true, data: { controller: "tom-select" },  selected: @coaches.reject { |coach| coach == @coach } } %>
      <div class="flexy">
        <%= f.button :submit, "Valider", class: "btn btn-etendart-yellow" %>
      </div>
      <% end %>
    </div>
  </div>
</div>

<div class="yellow-title yellow-title-flex">
  LISTE DES ÉLÈVES
  <%= link_to export_activity_students_managers_activity_path(activity: @activity, format: :csv) do %>
    <i class="fa-solid fa-download fa-download-black"></i>
  <% end %>
</div>
<div class="container" data-controller="clickable-table">
  <table class="table table-striped table-responsive table-center form-container">
    <thead>
      <tr>
        <th>Nom</th>
        <th>Prénom</th>
        <th>Age</th>
        <th>Téléphone</th>
        <th>Email</th>
        <th>Supprimer</th>
      </tr>
    </thead>
    <tbody>
      <% @students.each do |student| %>
        <% membership = student.memberships.find_by(start_year: @start_year) %>
        <% name_style = membership&.status == false ? "color: red;font-weight: bold" : "" %>
        <tr class="clickable-tr" data-clickable-table-target="clickable" data-url="<%= managers_student_path(student) %>">
          <td class="align-middle" style="<%= name_style %>"><%= student.last_name %></td>
          <td class="align-middle" style="<%= name_style %>"><%= student.first_name %></td>
          <td class="align-middle"><%= student.age %> ans</td>
          <td class="align-middle"><%= student.phone_number %></td>
          <td class="align-middle"><%= student.email %></td>
          <td class="align-middle">
            <%= link_to managers_activity_enrollment_path(@activity.activity_enrollments.find_by(student_id: student.id), origin: 'camp'), method: :delete, data: { turbo_method: :delete, turbo_confirm: "Êtes-vous sûr de vouloir enlever cet élève ?" } do %>
              <i class="fas fa-trash trash"></i>
            <% end %>
          </td>
        </tr>
      <% end %>
    </tbody>
  </table>
</div>
