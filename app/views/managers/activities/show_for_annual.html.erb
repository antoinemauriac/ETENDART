<%= render "shared/academy_header" %>

<div class="header-nav">
  <div class="header-nav-item"><%= link_to @academy.name.upcase, managers_academy_path(@academy) %></div>
  <div class="header-nav-item"><%= link_to "LES PROGRAMMES", managers_annual_programs_path(academy: @academy) %></div>
  <div class="header-nav-item"><%= link_to @annual_program.name, managers_annual_program_path(@annual_program)  %></div>
  <div class="header-nav-item active"><%= @activity.name.upcase  %></div>
</div>

<div class="yellow-title"><%= @activity.name.upcase %></div>
<div class="row justify-content-center align-items-stretch">

  <div class="col-8" >
    <div class="header-info">PROCHAINS COURS</div>
    <table class="table table-striped table-responsive table-center form-container form-container-activity">
      <thead>
        <tr>
          <th>Date</th>
          <th>Heure de début</th>
          <th>Heure de fin</th>
          <th>Modifier</th>
          <th>Supprimer</th>
        </tr>
      </thead>
      <tbody>
        <% @courses.each do |course| %>
          <%= simple_form_for course, url: managers_course_path(course), method: :put, data: { turbo: false } do |f| %>
          <tr>
          <td class="align-middle">
            <div class="d-flex">
              <%= link_to l(course.starts_at, format: :abbr), managers_course_path(course), class: "btn-etendart-yellow mb-2", style: "width: 80%" %>
            </div>
          </td>
            <td class="align-middle">
              <%= f.input :starts_at, as: :time, label: false, minute_step: 15 %>
            </td>
            <td class="align-middle">
              <%= f.input :ends_at, as: :time, label: false, minute_step: 15 %>
            </td>
            <td class="align-middle">
              <%= f.submit "Valider", class: 'btn-etendart-yellow mb-2' %>
            </td>
          <% end %>
            <td class="align-middle">
              <%= link_to managers_course_path(course), data: {turbo_method: :delete, turbo_confirm: "Êtes-vous sûr de vouloir supprimer ce cours ?"} do %>
                <i class="fas fa-trash trash"></i>
              <% end %>
            </td>
          </tr>
        <% end %>
      </tbody>
    </table>
    <div class="flexy">
      <%= link_to "Voir tous", all_annual_courses_managers_activity_path(@activity), class: "btn-etendart mb-2 mt-0" %>
    </div>
  </div>
  <div class="col-4">
    <div class="header-info">COACH</div>
    <div class="form-container form-container-activity">
      <%= simple_form_for @activity, url: managers_activity_path(@activity), method: :patch do |f| %>

      <%= f.input :coach_id, as: :select, label: "Coach Principal", collection: @coaches, label_method: :full_name, value_method: :id, input_html: { class: "tom-select", data: { controller: "tom-select" } } %>
      <%= f.input :coach_ids, as: :select, label: "Autres coachs", collection: @coaches.reject { |coach| coach == @coach }, label_method: :full_name, value_method: :id, input_html: { class: "tom-select", multiple: true, data: { controller: "tom-select" }, selected: @coaches.reject { |coach| coach == @coach } } %>
      <div class="flexy">
        <%= f.button :submit, "Valider", class: "btn btn-etendart-yellow" %>
      </div>
      <% end %>
    </div>
  </div>
</div>

<div class="yellow-title yellow-title-flex">
  LISTE DES ÉLÈVES
  <%= link_to export_activity_students_managers_activity_path(activity: @activity, format: :csv) do %>
    <i class="fa-solid fa-download fa-download-black"></i>
  <% end %>
</div>
<div class="container" data-controller="clickable-table">
  <table class="table table-striped table-responsive table-center form-container">
    <thead>
      <tr>
        <th>Nom</th>
        <th>Prénom</th>
        <th>Age</th>
        <th>Téléphone</th>
        <th>Email</th>
        <th>Supprimer</th>
      </tr>
    </thead>
    <tbody>
      <% @students.each do |student| %>
        <tr class="clickable-tr" data-clickable-table-target="clickable" data-url="<%= managers_student_path(student, academy_id: @academy.id) %>">
          <td class="align-middle"><%= student.last_name %></td>
          <td class="align-middle"><%= student.first_name %></td>
          <td class="align-middle"><%= student.age %> ans</td>
          <td class="align-middle"><%= student.phone_number %></td>
          <td class="align-middle"><%= student.email %></td>
          <td class="align-middle">
            <%= link_to managers_activity_enrollment_path(@activity.activity_enrollments.find_by(student_id: student.id)), method: :delete, data: { turbo_method: :delete, turbo_confirm: "Êtes-vous sûr de vouloir enlever cet élève ?" } do %>
              <i class="fas fa-trash trash"></i>
            <% end %>
          </td>
        </tr>
      <% end %>
    </tbody>
  </table>
</div>
