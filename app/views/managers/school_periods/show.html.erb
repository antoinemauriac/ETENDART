<%= render "shared/academy_header" %>
<div class="header-nav">
  <div class="header-nav-item"><%= link_to @school_period.academy.name.upcase, managers_academy_path(@school_period.academy) %></div>
  <div class="header-nav-item"><%= link_to "LES STAGES", managers_academy_school_periods_path(@school_period.academy, @school_period) %></div>
  <div class="header-nav-item active"><%= @school_period.name.upcase %> - <%= @school_period.year %> </div>
</div>
<div class="yellow-title"><%= @school_period.name.upcase %> - <%= @school_period.year %></div>

<div class="container" data-controller="clickable-table">
  <table class="table table-striped table-responsive table-center form-container">
    <thead>
      <tr>
        <th>Académie</th>
        <th>Stage</th>
        <th>Semaine</th>
        <th>Début</th>
        <th>Fin</th>
        <th>Élèves inscrits</th>
        <th>Action</th>
      </tr>
    </thead>
    <tbody>
      <% @school_period.camps.each do |camp| %>
      <tr class="clickable-tr" data-clickable-table-target="clickable" data-url="<%= managers_camp_path(camp) %>">
        <td class="align-middle"><%= @school_period.academy.name %></td>
        <td class="align-middle"><%= @school_period.name %></td>
        <td class="align-middle"><%= camp.name %></td>
        <td class="align-middle"><%= l(camp.starts_at, format: :date) %></td>
        <td class="align-middle"><%= l(camp.ends_at, format: :date) %></td>
        <td class="align-middle"><%= camp.students_count %></td>
        <td class="align-middle">
          <%= link_to managers_camp_path(camp), method: :delete, data: { turbo_method: :delete, turbo_confirm: "Êtes-vous sûr de vouloir supprimer cette semaine ?" } do %>
            <i class="fas fa-trash trash"></i>
          <% end %>
        </td>
      </tr>
      <% end %>
    </tbody>
  </table>

  <div class="flexy" data-controller="hidden-forms">
    <button class="btn-etendart-square" id="add-camp-btn">AJOUTER UNE SEMAINE</button>
    <%= form_with(model: @camp, url: managers_school_period_camps_path(@school_period), method: :post, class: "hidden-form form-container", id: "camp-form") do |form| %>
      <%= form.label :name, "Nom :" %>
      <%= form.text_field :name, class: "form-control", placeholder: "semaine1", required: true %>
      <%= form.label :starts_at, "Date de début :" %>
      <%= form.date_field :starts_at, class: "form-control" %>
      <%= form.label :ends_at, "Date de fin :" %>
      <%= form.date_field :ends_at, class: "form-control" %>
      <div class="flex-btn">
        <%= form.submit "Valider", class: "btn-etendart" %>
        <button class="btn-etendart-black" id="cancel-camp-btn" type="button">Annuler</button>
      </div>
    <% end %>
  </div>
</div>

<div class="yellow-title mb-3 mt-3">IMPORT CSV</div>
<div class="container flexy">
  <div class="form-container" data-controller="import-csv">
    <%= simple_form_for(@school_period, url: managers_students_import_path, method: :post, data: { action: "change->import-csv#handleFileSelect" }) do |form| %>
      <%= form.input :school_period_id, as: :hidden, input_html: { value: @school_period.id } %>
      <div class="form-group">
        <%= form.input :csv_file, as: :file, label: false, input_html: { accept: '.csv', data: { import_csv_target: "csvFileInput" }, class: "form-control-file" } %>
      </div>
      <%= form.submit 'Importer', disabled: true, data: { import_csv_target: "importButton" }, class: "btn btn-primary" %>
    <% end %>
  </div>
</div>
