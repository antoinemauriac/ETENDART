<%= render "shared/academy_header" %>
<div class="yellow-title"><%= @school_period.name %></div>

<div class="container">
  <table class="table table-striped table-responsive">
    <thead>
      <tr>
        <th>Académie</th>
        <th>Stage</th>
        <th>Semaine</th>
        <th>Élèves inscrits</th>
        <th>Action</th>
      </tr>
    </thead>
    <tbody>
      <% @school_period.camps.each do |camp| %>
      <tr class="clickable-tr" data-url="<%= managers_camp_path(camp) %>">
        <td><%= @school_period.academy.name %></td>
        <td><%= @school_period.name %></td>
        <td><%= camp.name %></td>
        <td></td>
        <td>
          <%= link_to managers_camp_path(camp), method: :delete, data: { turbo_method: :delete, turbo_confirm: "Êtes-vous sûr de vouloir supprimer cette période scolaire ?" } do %>
            <i class="fas fa-trash"></i>
          <% end %>
        </td>
      </tr>
      <% end %>
    </tbody>
  </table>

  <div data-controller="hidden-forms">
    <button class="btn btn-primary" id="add-camp-btn">Ajouter une semaine</button>
    <%= form_with(model: @camp, url: managers_school_period_camps_path(@school_period), method: :post, class: "hidden-form", id: "camp-form") do |form| %>
      <%= form.label :name, "Nom :" %>
      <%= form.text_field :name, class: "form-control" %>
      <%= form.label :starts_at, "Date de début :" %>
      <%= form.date_field :starts_at, class: "form-control" %>
      <%= form.label :ends_at, "Date de fin :" %>
      <%= form.date_field :ends_at, class: "form-control" %>
      <%= form.submit "Valider", class: "btn btn-primary" %>
      <button class="btn btn-primary" id="cancel-camp-btn" type="button">Annuler</button>
    <% end %>
  </div>

  <div data-controller="import-csv">
    <%= form_with(url: managers_students_import_path, method: :post, data: { action: "change->import-csv#handleFileSelect" }) do |form| %>
      <%= form.hidden_field :school_period_id, value: @school_period.id %>
      <%= form.file_field :csv_file, accept: '.csv', data: { import_csv_target: "csvFileInput" } %>
      <%= form.submit 'Importer', disabled: true, data: { import_csv_target: "importButton" } %>
    <% end %>
  </div>
</div>
